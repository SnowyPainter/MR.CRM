<!DOCTYPE html>
<html>
  <head>
    <%- include('./header.ejs') %>
    <title>Create new form</title>
  </head>
  <body>
    <%- include('./navbar.ejs') %> 
    <div id="main">
      <div class="container">
          <h1 class="title">Preview</h1>
      </div>
      <div class="container">
        <h1 class="title">Construct form</h1>
      </div>
      <div class="container" id="addfield">
        <h1 class="title">Add field</h1>
        <div id="fields">

        </div>
        <input type="text"><button onclick="addField()">Add Field</button>
      </div>
    </div>
    <script src="/javascripts/base.js"></script>
    <script>
      const createField = (id, value) => {
        let field = document.createElement("div")
        field.classList.add("field");
        let input = document.createElement("input")
        input.value =  value; input.id = id;
        let editBtn = document.createElement("button")
        editBtn.innerText = "Edit";
        let deleteBtn = document.createElement("button")
        deleteBtn.innerText = "X";
        field.appendChild(input);
        field.appendChild(editBtn);
        field.appendChild(deleteBtn);
        return field;
      }
      const getListOfFields = () => new Promise((rs, rj) => {
          getAjax("/report/get/fields", (res) => {rs(res)})
        })
      let listOfFields = []

      function refreshAddFieldContainer() {
        let c = document.getElementById("fields")
        getListOfFields().then((list) => {
          listOfFields = JSON.parse(list).fields;
          listOfFields.forEach((field) => {
            c.appendChild(createField(field.id, field.field))
          });
        })
      }

      const prev = window.onload;
      window.onload = () => {
        if(prev) prev();
        refreshAddFieldContainer();
      } 
    </script>
  </body>
</html>
