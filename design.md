프로젝트 관리자 PM을 위한 프로젝트 관리 이야기에서 많이 배운 내용을 토대로 프로그램 명세서를 간략히 작성하고자 한다.

# 페이지 디자인
|머릿글||
|---|---|
|활동바|본문|
|바닥글|

머릿글에는 고객이 원하는 것을 집어넣음 가령 회사명, 검색창 등이 자리할 수 있다.  
바닥글에는 회사 주소나 전화번호, 이메일 등을 표기한다.  
머릿글과 바닥글은 한 ejs페이지에 수록하고 기본 레이아웃으로 지정하지만 활동바는 따로 첨가하는 방식을 채택한다.

# 미들웨어 디자인
## permissionCheck
접속하고자 하는 팀 아이디와 소속팀 또는 권한을 대조하여 flag-bool 을 반환한다.

## authIfNotRedirectLogin
JWT 토큰을 확인하여 로그인되었는지 확인한다. 만약 로그인되었다면 data property에 JWT 정보를 담는다. 로그인되지 않았다면 인덱스 페이지로 이동된다.

### 사용처
1. 모든 report, teams, user 하위 url에서는 미들웨어가 작동하여 로그인 여부를 검사한다.
2. 예외적으로 /user/ 에서는 checkLogin 미들웨어를 사용한다.
3. /user/manage 및 다른 모든 **변경** 쿼리에서는 사용자가 매니저 권한이 있는지 검사한다.

## checkLogin
JWT 토큰을 확인하고 res의 login property에 login 의 bool 값을 저장한다. 또한 data property에 JWT 정보를 담는다.

### 사용처
login.ejs에 접속한다면 checkLogin이 작동하여 로그인되었는지 판별하고 그에 따른 정보를 보여준다.

# 사용자 인터렉션 디자인
## 인덱스
로그인하였을때 관리자라면 유저, 팀, 보고서 양식 관리 및 생성, 팀 생성 항목을 추가하여 보여주고, 아니라면 보여주지 않는다.  이떄 기본적으로 팀 목록은 보여지게 된다.

## 로그인
로그인과 로그아웃 페이지는 login 페이지에서 이루어진다. 모든 페이지(login제외)는 body onload 에 따로 onload.js 를 불러와서 그것에 로그인 여부를 확인하는 함수를 지정해야 한다. 만약 로그인되어지지 않았다면 login 페이지로 이동하는 ``` document.location.href ``` 스크립트를 짠다.  
### JWT
팀 접근 권한, 아이디, 소속팀이 있다. 팀 접근 권한의 종류는 쉼표로 구분되어진다. 띄어쓰고 열람 및 수정 여부를 지정해야 한다.
## 유저 관리
페이지 한 단에 유저 정보를 포함하며 수정 버튼을 누르면 유저 수정 div를 열고 그 외에 disable한다.  
유저 퍼미션의 경우는 listbox에 나열하고 combobox:combobox 형식으로 팀:권한을 나타낸다.  
버튼 트리깅으로 일괄 수정한다.  

## 보고서 양식 생성
생성 컨테이너, 미리보기 컨테이너, 필드 추가 컨테이너, 필드 수정(삭제, 변경) 컨테이너가 존재한다.  
무엇인지 나타내는 필드, 값을 어떤 방식으로 입력해야하는 필드로 나뉜다.  
리스트박스:리스트박스 형식으로 보이게 된다.
```
필드 선택 : 입력 방식 선택
```
### 보고서 필드 생성
필드를 추가한다. 이때 생성되는 필드는 ajax 통신으로 바로 그것의 id가 전송되어진다. CRUD 가능하다.

### 보고서 질의 생성
생성된 필드를 기반으로 어떠한 입력(text, file, yes or no)을 받을지 결정해서 ajax 통신으로 db에 저장한다. CRUD 가능하다.

## 보고서 제출
보고서 제출은 manager가 직접 설정한 보고서 양식에 맞추어 이루어진다. 다양한 필드를 설정하고 필드의 값의 타입을 설정한다. 또, 받을 파일에 대해서도 설정할 수 있어야 한다.  
보고서를 제출하기 위해서는 활동바에 제시되어지는 팀 접속, 팀 쓰기 권한이 있어야 한다.